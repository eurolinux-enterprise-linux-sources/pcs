From 120d3a613d2ceda1bfb4ed089d36fbfd5e331738 Mon Sep 17 00:00:00 2001
From: Ondrej Mular <omular@redhat.com>
Date: Fri, 8 Jan 2016 12:56:43 +0100
Subject: [PATCH] web UI: fix updating resource when there is no stonith device (and vice versa)

---
 pcsd/public/js/nodes-ember.js |    6 ++++++
 pcsd/public/js/pcsd.js        |   39 +++++++++++++++++++++++++++++++++++++--
 2 files changed, 43 insertions(+), 2 deletions(-)

diff --git a/pcsd/public/js/nodes-ember.js b/pcsd/public/js/nodes-ember.js
index c3e8e80..4f33768 100644
--- a/pcsd/public/js/nodes-ember.js
+++ b/pcsd/public/js/nodes-ember.js
@@ -479,6 +479,9 @@ Pcs.resourcesContainer = Ember.Object.create({
   },
 
   enable_resource: function(resource_id) {
+    if (resource_id == null) {
+      return;
+    }
     $.ajax({
       type: 'POST',
       url: get_cluster_remote_url() + 'resource_start',
@@ -502,6 +505,9 @@ Pcs.resourcesContainer = Ember.Object.create({
   },
 
   disable_resource: function(resource_id) {
+    if (resource_id == null) {
+      return;
+    }
     $.ajax({
       type: 'POST',
       url: get_cluster_remote_url() + 'resource_stop',
diff --git a/pcsd/public/js/pcsd.js b/pcsd/public/js/pcsd.js
index 4412e49..63a7652 100644
--- a/pcsd/public/js/pcsd.js
+++ b/pcsd/public/js/pcsd.js
@@ -1,11 +1,19 @@
 var pcs_timeout = 30000;
 
 function curResource() {
-  return Pcs.resourcesContainer.get('cur_resource').get('id')
+  var obj = Pcs.resourcesContainer.get('cur_resource');
+  if (obj == null) {
+    return null;
+  }
+  return obj.get('id');
 }
 
 function curStonith() {
-  return Pcs.resourcesContainer.get('cur_fence').get('id')
+  var obj = Pcs.resourcesContainer.get('cur_fence');
+  if (obj == null) {
+    return null;
+  }
+  return obj.get('id');
 }
 
 function configure_menu_show(item) {
@@ -583,6 +591,9 @@ function disable_resource() {
 
 function cleanup_resource() {
   var resource = curResource();
+  if (resource == null) {
+    return;
+  }
   fade_in_out("#resource_cleanup_link");
   $.ajax({
     type: 'POST',
@@ -601,6 +612,9 @@ function cleanup_resource() {
 
 function cleanup_stonith() {
   var resource = curStonith();
+  if (resource == null) {
+    return;
+  }
   fade_in_out("#stonith_cleanup_link");
   $.ajax({
     type: 'POST',
@@ -1461,6 +1475,9 @@ function node_unmaintenance(node) {
 
 function remove_meta_attr(parent_id) {
   var resource_id = curResource();
+  if (resource_id == null) {
+    return;
+  }
   var attr = parent_id.attr("meta_attr_key");
   fade_in_out(parent_id.parent());
   Pcs.resourcesContainer.update_meta_attr(resource_id, attr);
@@ -1468,6 +1485,9 @@ function remove_meta_attr(parent_id) {
 
 function add_meta_attr(parent_id) {
   var resource_id = curResource();
+  if (resource_id == null) {
+    return;
+  }
   var attr = $(parent_id + " input[name='new_meta_key']").val();
   var value = $(parent_id + " input[name='new_meta_value']").val();
   fade_in_out($(parent_id));
@@ -2055,6 +2075,9 @@ function tree_view_checkbox_onchange(element) {
 }
 
 function resource_master(resource_id) {
+  if (resource_id == null) {
+    return;
+  }
   show_loading_screen();
   $.ajax({
     type: 'POST',
@@ -2074,6 +2097,9 @@ function resource_master(resource_id) {
 }
 
 function resource_clone(resource_id) {
+  if (resource_id == null) {
+    return;
+  }
   show_loading_screen();
   $.ajax({
     type: 'POST',
@@ -2093,6 +2119,9 @@ function resource_clone(resource_id) {
 }
 
 function resource_unclone(resource_id) {
+  if (resource_id == null) {
+    return;
+  }
   show_loading_screen();
   var resource_obj = Pcs.resourcesContainer.get_resource_by_id(resource_id);
   if (resource_obj.get('class_type') == 'clone') {
@@ -2116,6 +2145,9 @@ function resource_unclone(resource_id) {
 }
 
 function resource_ungroup(group_id) {
+  if (group_id == null) {
+    return;
+  }
   show_loading_screen();
   $.ajax({
     type: 'POST',
@@ -2135,6 +2167,9 @@ function resource_ungroup(group_id) {
 }
 
 function resource_change_group(resource_id, group_id) {
+  if (resource_id == null) {
+    return;
+  }
   show_loading_screen();
   var resource_obj = Pcs.resourcesContainer.get_resource_by_id(resource_id);
   var data = {
-- 
1.7.1

