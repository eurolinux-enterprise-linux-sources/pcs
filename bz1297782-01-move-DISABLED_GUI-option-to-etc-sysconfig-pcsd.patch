From 2d3c8907487802942c42c0f1e27d7d7e679a9699 Mon Sep 17 00:00:00 2001
From: Tomas Jelinek <tojeline@redhat.com>
Date: Tue, 12 Jan 2016 16:45:14 +0100
Subject: [PATCH] move DISABLED_GUI option to /etc/sysconfig/pcsd

---
 pcsd/pcsd      |    2 ++
 pcsd/pcsd.conf |    2 ++
 pcsd/pcsd.rb   |    2 +-
 3 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/pcsd/pcsd b/pcsd/pcsd
index 1257f9c..6b3b04f 100755
--- a/pcsd/pcsd
+++ b/pcsd/pcsd
@@ -26,7 +26,9 @@ prog="pcsd"
 config="/var/lib/pcsd"
 pidfile="/var/run/pcsd.pid"
 
+set -a
 [ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
+set +a
 
 lockfile=/var/lock/subsys/$prog
 
diff --git a/pcsd/pcsd.conf b/pcsd/pcsd.conf
index f596d59..38c7ea2 100644
--- a/pcsd/pcsd.conf
+++ b/pcsd/pcsd.conf
@@ -2,3 +2,5 @@
 # Set PCSD_DEBUG to true for advanced pcsd debugging information
 PCSD_DEBUG=false
 RACK_ENV=production
+# Set DISABLE_GUI to true to disable GUI frontend in pcsd
+DISABLE_GUI=false
diff --git a/pcsd/pcsd.rb b/pcsd/pcsd.rb
index 059d3a2..a4f6bab 100644
--- a/pcsd/pcsd.rb
+++ b/pcsd/pcsd.rb
@@ -76,7 +76,7 @@ before do
 end
 
 configure do
-  DISABLE_GUI = false
+  DISABLE_GUI = (ENV['DISABLE_GUI'] and ENV['DISABLE_GUI'].downcase == 'true')
   PCS = get_pcs_path(File.expand_path(File.dirname(__FILE__)))
   logger = File.open("/var/log/pcsd/pcsd.log", "a+", 0600)
   STDOUT.reopen(logger)
-- 
1.7.1

