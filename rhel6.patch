From e78ee9a0e3ed9a5a3551c5c0ebd15bbc6b6fec1c Mon Sep 17 00:00:00 2001
From: Ivan Devat <idevat@redhat.com>
Date: Tue, 11 Oct 2016 12:18:24 +0200
Subject: [PATCH] main rhel6 patch

---
 pcsd/Makefile | 10 +---------
 pcsd/auth.rb  |  2 +-
 pcsd/pcsd.pam |  8 ++++----
 3 files changed, 6 insertions(+), 14 deletions(-)

diff --git a/pcsd/Makefile b/pcsd/Makefile
index e5ee6de..046ad33 100644
--- a/pcsd/Makefile
+++ b/pcsd/Makefile
@@ -1,9 +1,4 @@
-build_gems: get_gems
-	bundle install --local --deployment
-
-# RHEL6 needs special rpam-ruby19 gem to work with 1.8.7
-# also bundler is not available on RHEL6 in rpm
-build_gems_rhel6:
+build_gems:
 	mkdir -p vendor/bundle/ruby
 	gem install --verbose --no-rdoc --no-ri -l -i vendor/bundle/ruby \
 	vendor/cache/backports-3.6.8.gem \
@@ -20,8 +15,5 @@ build_gems_rhel6:
 	vendor/cache/sinatra-contrib-1.4.7.gem \
 	-- '--with-ldflags="-Wl,-z,now -Wl,-z,relro"'
 
-get_gems:
-	bundle package
-
 clean:
 	rm -rfv vendor/
diff --git a/pcsd/auth.rb b/pcsd/auth.rb
index e87f5a3..39bcecc 100644
--- a/pcsd/auth.rb
+++ b/pcsd/auth.rb
@@ -1,6 +1,6 @@
 require 'json'
 require 'securerandom'
-gem 'rpam-ruby19'
+gem 'rpam-ruby19-feist'
 require 'rpam'
 require 'base64'
 
diff --git a/pcsd/pcsd.pam b/pcsd/pcsd.pam
index fcb7a46..fc807ae 100644
--- a/pcsd/pcsd.pam
+++ b/pcsd/pcsd.pam
@@ -1,5 +1,5 @@
 #%PAM-1.0
-auth       include      system-auth
-account    include      system-auth
-password   include      system-auth
-session    include      system-auth
+auth       include      password-auth
+account    include      password-auth
+password   include      password-auth
+session    include      password-auth
-- 
1.8.3.1

