--- pcs-0.9.118/pcsd/pcsd.rhel6	2014-06-05 18:10:13.000000000 -0500
+++ pcs-0.9.118/pcsd/pcsd	2014-06-09 18:03:27.570642088 -0500
@@ -13,8 +13,8 @@
 # Should-Stop: 
 # Default-Start:
 # Default-Stop:
-# Short-Description: Starts and stops Pacemaker & Corosync daemon
-# Description: Starts and stops Pacemaker & Corosync daemon
+# Short-Description: Starts and stops Pacemaker & Corosync Configuration daemon
+# Description: Starts and stops Pacemaker & Corosync Configuration daemon
 ### END INIT INFO
 
 # Source function library.
@@ -23,6 +23,7 @@
 exec="/usr/bin/ruby"
 prog="pcsd"
 config="/var/lib/pcsd"
+pidfile="/var/run/pcsd.pid"
 
 [ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
 
@@ -31,11 +32,20 @@ lockfile=/var/lock/subsys/$prog
 start() {
     [ -x $exec ] || exit 5
     echo -n $"Starting $prog: "
-    export GEM_HOME=/usr/lib/pcsd/vendor/bundle/ruby
-    cd /var/lib/pcsd
-    daemon $exec -I/usr/lib/pcsd /usr/lib/pcsd/ssl.rb
-    # if not running, start it up here, usually something like "daemon $exec"
-    retval=$?
+    if status $prog > /dev/null 2>&1; then
+	success
+    else
+	export GEM_HOME=/usr/lib/pcsd/vendor/bundle/ruby
+	cd /var/lib/pcsd
+	nohup $exec -I/usr/lib/pcsd /usr/lib/pcsd/ssl.rb > /dev/null 2>&1 & echo $! > $pidfile
+	retval=$?
+	[ $retval -eq 0 ] && touch $lockfile
+	if status $prog > /dev/null 2>&1; then
+	    success
+	else
+	    failure
+        fi
+    fi
     echo
     [ $retval -eq 0 ] && touch $lockfile
     return $retval
@@ -44,7 +54,14 @@ start() {
 stop() {
     echo -n $"Stopping $prog: "
     # stop it here, often "killproc $prog"
+    killproc $prog
     retval=$?
+    [ $retval -eq 0 ] && rm -f $lockfile
+    if [ $retval -eq 0 ]; then
+        success
+    else
+	failure
+    fi
     echo
     [ $retval -eq 0 ] && rm -f $lockfile
     return $retval
--- pcs-0.9.118/pcsd/pcsd.pam.rhel6	2014-06-09 18:03:44.836459569 -0500
+++ pcs-0.9.118/pcsd/pcsd.pam	2014-06-09 18:03:55.255349434 -0500
@@ -1,5 +1,5 @@
 #%PAM-1.0
-auth       include      system-auth
-account    include      system-auth
-password   include      system-auth
-session    include      system-auth
+auth       include      password-auth
+account    include      password-auth
+password   include      password-auth
+session    include      password-auth
--- pcs-0.9.139/pcsd/ssl.rb.rhel6
+++ pcs-0.9.139/pcsd/ssl.rb
@@ -53,7 +53,7 @@ end
 
 webrick_options = {
   :Port               => 2224,
-  :BindAddress        => nil,
+  :BindAddress        => "::",
   :SSLEnable          => true,
   :SSLVerifyClient    => OpenSSL::SSL::VERIFY_NONE,
   :SSLCertificate     => OpenSSL::X509::Certificate.new(File.open(CRT_FILE).read),
@@ -84,4 +84,7 @@ end
 require 'pcsd'
 begin
   server.run(Sinatra::Application, webrick_options)
+rescue Errno::EAFNOSUPPORT
+  webrick_options[:BindAddress] = '0.0.0.0'
+  server.run(Sinatra::Application, webrick_options)
 end
--- pcs-0.9.139/pcs/cluster.py.rhel6
+++ pcs-0.9.139/pcs/cluster.py
@@ -366,7 +366,7 @@ def corosync_setup(argv,returnConfig=False):
             )
 
     if transport == "udpu" and utils.is_rhel6():
-        print("Warning: Using udpu transport on a CMAN cluster, "
+        print("Warning: Using udpu transport on a RHEL 6 cluster, "
             + "cluster restart is required after node add or remove")
     if (
         transport == "udpu"
@@ -481,10 +481,10 @@ def corosync_setup(argv,returnConfig=False):
             transport = "udpb"
             if "--broadcast0" not in utils.pcs_options:
                 print("Warning: Enabling broadcast for ring 0 "
-                    + "as CMAN does not support broadcast in only one ring")
+                    + "as RHEL 6 does not support broadcast in only one ring")
             if "--broadcast1" not in utils.pcs_options:
                 print("Warning: Enabling broadcast for ring 1 "
-                    + "as CMAN does not support broadcast in only one ring")
+                    + "as RHEL 6 does not support broadcast in only one ring")
 
         cluster_conf_location = settings.cluster_conf_file
         if returnConfig:
@@ -605,22 +605,22 @@ def corosync_setup(argv,returnConfig=False):
 
         if "--wait_for_all" in utils.pcs_options:
             print "Warning: --wait_for_all"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
         if "--auto_tie_breaker" in utils.pcs_options:
             print "Warning: --auto_tie_breaker"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
         if "--last_man_standing" in utils.pcs_options:
             print "Warning: --last_man_standing"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
         if "--last_man_standing_window" in utils.pcs_options:
             print "Warning: --last_man_standing_window"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
         if "--token_coefficient" in utils.pcs_options:
             print "Warning: --token_coefficient"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
         if "--ipv6" in utils.pcs_options:
             print "Warning: --ipv6"\
-                " ignored as it is not supported on CMAN clusters"
+                " ignored as it is not supported on RHEL 6 clusters"
 
         if returnConfig:
             cc_temp.seek(0)
@@ -1097,7 +1097,7 @@ def cluster_node(argv):
             utils.err("Unable to update any nodes")
         output, retval = utils.reloadCorosync()
         if utils.is_cman_with_udpu_transport():
-            print("Warning: Using udpu transport on a CMAN cluster, "
+            print("Warning: Using udpu transport on a RHEL 6 cluster, "
                 + "cluster restart is required to apply node addition")
     else:
         if node0 not in utils.getNodesFromCorosyncConf():
@@ -1156,7 +1156,7 @@ def cluster_node(argv):
         output, retval = utils.reloadCorosync()
         output, retval = utils.run(["crm_node", "--force", "-R", node0])
         if utils.is_cman_with_udpu_transport():
-            print("Warning: Using udpu transport on a CMAN cluster, "
+            print("Warning: Using udpu transport on a RHEL 6 cluster, "
                 + "cluster restart is required to apply node removal")
 
 def cluster_localnode(argv):
@@ -1300,7 +1300,7 @@ def cluster_uidgid(argv, silent_list = False):
 
 def cluster_get_corosync_conf(argv):
     if utils.is_rhel6():
-        utils.err("corosync.conf is not supported on CMAN clusters")
+        utils.err("corosync.conf is not supported on RHEL 6 clusters")
 
     if len(argv) > 1:
         usage.cluster()
@@ -1467,7 +1467,7 @@ def cluster_quorum_unblock(argv):
         sys.exit(1)
 
     if utils.is_rhel6():
-        utils.err("operation is not supported on CMAN clusters")
+        utils.err("operation is not supported on RHEL 6 clusters")
 
     output, retval = utils.run(
         ["corosync-cmapctl", "-g", "runtime.votequorum.wait_for_all_status"]
--- pcs-0.9.139/pcsd/views/manage.erb.rhel6
+++ pcs-0.9.139/pcsd/views/manage.erb
@@ -97,9 +97,9 @@
       <tr><td align=center style="color: red" colspan=2"><span id="at_least_one_node_error_msg" style="display:none;">At least one valid node must be entered.</span></td></tr>
       <tr><td align=center style="color: red" colspan=2"><span id="bad_cluster_name_error_msg" style="display:none;">You may not leave the cluster name field blank</span></td></tr>
       <tr><td align=center style="color: red" colspan=2"><span id="addr0_addr1_mismatch_error_msg" style="display:none;">Ring 1 addresses do not match to Ring 0 addresses</span></td></tr>
-      <tr><td align=center style="color: red" colspan=2"><span id="cman_udpu_transport_error_msg" style="display:none;">Cannot use UDPU transport on CMAN cluster. Please select UDP transport in Advanced options.</span></td></tr>
+      <tr><td align=center style="color: red" colspan=2"><span id="cman_udpu_transport_error_msg" style="display:none;">Cannot use UDPU transport on RHEL 6 cluster. Please select UDP transport in Advanced options.</span></td></tr>
       <tr><td align=center style="color: red" colspan=2"><span id="rhel_version_mismatch_error_msg" style="display:none;">Cannot create a cluster using nodes running different versions of RHEL.</span></td></tr>
-      <tr><td align=center style="color: red" colspan=2"><span id="cman_mismatch_error_msg" style="display:none;">Cannot mix nodes running CMAN and nodes without CMAN in one cluster.</span></td></tr>
+      <tr><td align=center style="color: red" colspan=2"><span id="cman_mismatch_error_msg" style="display:none;">Cannot mix nodes running RHEL 6 and nodes running RHEL 7 in one cluster.</span></td></tr>
     </table>
     <span onclick='$(".advanced_open").toggle();$("#advanced_cluster_create_options").toggle();'><span class="advanced_open rightarrow sprites"></span><span class="advanced_open downarrow sprites" style="display:none;"></span>Advanced Options:</span>
     <div id="advanced_cluster_create_options" style="display:none;">
@@ -129,7 +129,7 @@ remaining 3 nodes will be fenced.
 
 It is very useful when combined with Last Man Standing.
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
 	<% auto_tie_desc = "\
 Enables Auto Tie Breaker (ATB) feature (default: off).
 
@@ -142,7 +142,7 @@ partition, or the set of nodes that are still in contact with the \
 node that has the lowest nodeid will remain quorate. The other nodes \
 will be inquorate.
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
 	<% last_man_desc = "\
 Enables Last Man Standing (LMS) feature (default: off).
 
@@ -163,18 +163,18 @@ Using the above 8 node cluster example, with LMS enabled the cluster \
 can retain quorum and continue operating by losing, in a cascade \
 fashion, up to 6 nodes with only 2 remaining active.
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
 	<% last_man_window_desc = "\
 Tunes Last Man Standing Window (default: 10000 ms)
 
 The window of time between when a node (or group of nodes die) and quorum \
 is recalculated if the 'Last Man Standing' option is enabled.
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
 	<% use_ipv6_desc = "\
 Enables IPv6 for cluster communication (default: off)
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
         <% token_timeout = "\
 Sets time in milliseconds until a token loss is declared after not receiving \
 a token (default: 1000 ms)" %>
@@ -183,7 +183,7 @@ Sets time in milliseconds used for clusters with at least 3 nodes \
 as a coefficient for real token timeout calculation \
 (token + (number_of_nodes - 2) * token_coefficient) (default: 650 ms)
 
-This option has no effect on CMAN cluster." %>
+This option has no effect on RHEL 6 cluster." %>
         <% join_timeout = "\
 Sets time in milliseconds to wait for join messages (default: 50 ms)" %>
         <% consensus_timeout = "\
diff --git a/pcsd/views/nodes.erb b/pcsd/views/nodes.erb
index eba0b99..7c0180c 100644
--- a/pcsd/views/nodes.erb
+++ b/pcsd/views/nodes.erb
@@ -303,7 +303,7 @@
       </tr>
       {{#if Pcs.is_cman_with_udpu_transport}}
       <tr>
-        <td colspan="2" style="color: orange">This is a CMAN cluster with UDPU transport,<br>cluster restart is required to apply node addition.</td>
+        <td colspan="2" style="color: orange">This is a RHEL 6 cluster with UDPU transport,<br>cluster restart is required to apply node addition.</td>
       </tr>
       {{/if}}
       <tr>
@@ -318,6 +318,6 @@
   <p style="font-size:12px;">Are you sure you want to remove the following nodes(s)?</p>
   <span id="nodes_to_remove"></span>
   {{#if Pcs.is_cman_with_udpu_transport}}
-    <p style="color: orange">This is a CMAN cluster with UDPU transport, cluster restart is required to apply node removal.</p>
+    <p style="color: orange">This is a RHEL 6 cluster with UDPU transport, cluster restart is required to apply node removal.</p>
   {{/if}}
 </div>
